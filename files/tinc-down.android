#! /system/bin/sh
# /etc/tinc/ho/tinc-down
# Cleanup link config before shutting down tinc VPN connection

tid=100
pri=5000

ip ru del pri $pri
ip ro flush table $tid
ip -6 ro flush table $tid

# Release udhcpc lease
pidfile=/data/local/udhcpc.pid
[ -f "$pidfile" ] && pid=$(cat "$pidfile")
if [ ! -z "$pid" -a -d "/proc/$pid" ]; then
  kill -USR2 "$pid"
  sleep 2
  [ -d "/proc/$pid" ] && kill "$pid"
fi

ip link set $INTERFACE down
