## /etc/systemd/network/20-{{ tinc_prefix }}{{ tinc_name }}.network
# per-link config of systemd-network
# {{ ansible_managed }}

[Match]
Name={{ tinc_prefix }}{{ tinc_name }}

[Network]
Description="tinc VPN {{ tinc_name }}"
LinkLocalAddressing=no
IPv6AcceptRA=no
LLMNR=false

{% if tinc_hostname %}
Address={{ tinc_subnet }}.{{ tinc_hostname | regex_replace('^.*tinc(\\d+).*$', '\\1') }}/24
{% if 'dns' not in group_names %}
DNS={{ tinc_subnet }}.1
{% endif %}
Domains={{ tinc_domain }}
IPForward=yes
{% endif %}

{% if systemd_broken_dhcp or 'vpn' in group_names %}
# use dhcpcd if needed, see {{ tinc_dir }}/tinc-up
DHCP=no
{% else %}
Domains=~.
DHCP=yes

[DHCP]
UseDomains=true
RouteMetric=400
UseHostname=false
{% endif %}
